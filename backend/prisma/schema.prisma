generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// *
///  * ======= MODELOS =======
model Proyecto {
  id          String        @id @default(uuid())
  nombre      String
  descripcion String?
  color       String
  deadline    DateTime?
  creadoPor   String
  usuarios    String[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  auditLogs   AuditLog[]
  messages    ChatMessage[]
  threads     ChatThread[]
  tareas      Tarea[]
}

model Tarea {
  id          String    @id @default(uuid())
  proyectoId  String
  titulo      String
  descripcion String?
  prioridad   Prioridad @default(media)
  deadline    DateTime?
  etiquetas   String[]
  estado      Estado    @default(por_hacer)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  createdBy   String?
  updatedBy   String?
  proyecto    Proyecto  @relation(fields: [proyectoId], references: [id], onDelete: Cascade)
}

model ChatThread {
  id           String        @id @default(uuid())
  proyectoId   String
  isPrivate    Boolean       @default(false)
  participants String[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  messages     ChatMessage[]
  proyecto     Proyecto      @relation(fields: [proyectoId], references: [id], onDelete: Cascade)
}

model ChatMessage {
  id         String      @id @default(uuid())
  proyectoId String
  sender     String
  text       String
  createdAt  DateTime    @default(now())
  threadId   String?
  updatedAt  DateTime    @updatedAt
  proyecto   Proyecto    @relation(fields: [proyectoId], references: [id], onDelete: Cascade)
  thread     ChatThread? @relation(fields: [threadId], references: [id])
}

model User {
  id           String    @id @default(uuid())
  email        String    @unique
  passwordHash String
  name         String?
  avatarUrl    String?
  birthdate    DateTime?
  jobTitle     String?
  phone        String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

model AuditLog {
  id         String   @id @default(uuid())
  proyectoId String
  entity     String
  entityId   String?
  action     String
  actorEmail String
  payload    Json?
  createdAt  DateTime @default(now())
  proyecto   Proyecto @relation(fields: [proyectoId], references: [id], onDelete: Cascade)
}

/// *
///  * ======= ENUMS =======
enum Estado {
  por_hacer   @map("por-hacer")
  en_progreso @map("en-progreso")
  completado
}

enum Prioridad {
  alta
  media
  baja
}
